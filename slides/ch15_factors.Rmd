---
title: "Factors - r4ds"
author: "Tomoya Fukumoto"
date: "2019-05-15"
output: ioslides_presentation
---
 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 7)
```

##  ファクタ
カテゴリ変数を扱う技術
 
### 準備
```{r prereq, results = "hide", message=FALSE, warning=FALSE}
library(tidyverse)
library(forcats)
```

神世界の一部だが、一括でロードはされない

関数はすべて`fct_`で始まる

## 尺度水準
そもそもカテゴリ変数とは？
 
<div align="center">
<img src="../img/measures_ja.png" width = 700>
</div>

[wikipedia](https://en.wikipedia.org/wiki/Level_of_measurement)

## 15.2 Creating Factor
ファクタを作る 

## factor
```{r factor.basic}
x1 <- c("Dec", "Apr", "Jan", "Mar")
y1 <- factor(x1, levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
y1
```

`levels`に存在しない要素は`NA`
```{r factor.na}
x2 <- c("Dec", "Apr", "Jam", "Mar")
y2 <- factor(x2, levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
y2
```

## 順序のコントロール
順序指定なしだとアルファベット順
```{r factor.alphabet}
factor(x1)
```

最初に現れた順
```{r factor.inorder}
factor(x1, levels = unique(x1))
```

## levels
factorの`levels`を文字列ベクトルとして取得
```{r levels}
y1 <- factor(x1, levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
levels(y1)
```

## 15.3 General Social Survey
今回扱うデータについて

## `gss_cat`
```{r gss_cat}
forcats::gss_cat
```

## 探索1
```{r count_gsscat}
gss_cat %>% count(race)
```

## 探索2
```{r bar_gsscat}
gss_cat %>%
  ggplot(aes(race)) + geom_bar() + scale_x_discrete(drop = FALSE)
```

## 練習問題
1~3

##15.4 Modifying factor order
ファクタの順序の変更

特にグラフを作るときは順序を変更したいよね

## 宗教ごとの平均テレビ視聴時間
```{r tvhour_by_relig}
relig_summary <- gss_cat %>%
  group_by(relig) %>%
  summarise(
    age = mean(age, na.rm = TRUE),
    tvhours = mean(tvhours, na.rm = TRUE),
    n = n()
  ) 
relig_summary
```

## 可視化
```{r tvhour_viz1}
ggplot(relig_summary, aes(tvhours, relig)) + geom_point()
```

## `fct_reorder`
```{r fct_reorder}
relig_summary %>%
  mutate(relig = fct_reorder(relig, tvhours)) %>%
  ggplot(aes(tvhours, relig)) + geom_point()
```



## 参考情報

- [尺度水準(wikipedia)](https://en.wikipedia.org/wiki/Level_of_measurement)
- [変数の尺度(統計ことはじめ)](https://bellcurve.jp/statistics/course/1562.html)
